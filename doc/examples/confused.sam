// The access control policy:
accessControlOn.
accessAllowed("alice", "compiler").
accessAllowed("alice", "output").
accessAllowed("compiler", "billing").
accessAllowed("compiler", "output").

// All objects have well-known or guessable addresses.
isPublic(?X) :- isObject(?X).

class Compiler {
    private Object myLog;

    public Compiler(File log) {
        myLog = log;
    }

    public void exec(Object target) {
        myLog.append();
        target.write();
    }
}

class File {
    public void write() {
    }

    public void append() {
    }
}

config {
    File billing;
    Compiler compiler;
    File output;
    Unknown alice;

    setup {
        billing = new File();
        compiler = new Compiler(billing);
        output = new File();
        alice = new Unknown(compiler, output);
    }

    test {
        alice.test();
    }
}

// The only things that should be able to happen which don't involve Alice are:
// 1. compiler invokes output.write()
// 2. compiler invokes billing.append()
mayCall("compiler", "output", "File.write").
mayCall("compiler", "billing", "File.append").
checkCalls("billing").

expectFailure.
