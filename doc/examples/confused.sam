import "includes/confusedMustCall.sam".

// The access control policy:
accessControlOn.
accessAllowed(<alice>, <compiler>).
accessAllowed(<alice>, <input>).
accessAllowed(<alice>, <output>).
accessAllowed(<compiler>, <billing>, "File.write").
accessAllowed(<compiler>, <output>, "File.write").
accessAllowed(<compiler>, <input>, "File.read").

// All objects have well-known or guessable addresses.
isPublic(?X) :- isObject(?X).

class Compiler {
    private Object myLog;

    public Compiler(File log) {
        myLog = log;
    }

    public void exec(File input, File output) {
        input.read();
        myLog.write();
        output.write();
    }
}

class File {
    public void read() { }
    public void write() { }
}

config {
    test {
        File billing = new File();
        Compiler compiler = new Compiler(billing);
        File input = new File();
        File output = new File();
        Object alice = new Unknown();

        alice.test(compiler, input, output);
    }
}

class Alice {
    public void test(Compiler compiler, File input, File output) {
        input.write();
        compiler.exec(input, output);
        output.read();
    }
}

expectFailure.
