class ReadOnly {
    private Object myUnderlying;

    public ReadOnly(Object underlying) {
        myUnderlying = underlying;
    }

    public Object read() {
        Object value = myUnderlying.read();
        return value;
    }

    public Object readOnly() {
        return this;    // Already read-only
    }
}

class Logger {
    private Object myUnderlying;

    public Logger(Object underlying) {
        myUnderlying = underlying;
    }

    public Object *(Object arg*) {
        String method = ?MethodName :- didCall($Caller, ?CInvocation, ?CallSite, this, $Context, ?Method),
                                        callsMethod(?CallSite, ?MethodName);
        Object value = myUnderlying.$method(arg*);
        return value;
    }
}

class File {
    public void write() { }

    public Object read() { }

    public Object readOnly() {
        Object readOnly = new ReadOnly(this);
        return readOnly;
    }
}

config {
    Logger loggedReadOnly;

    setup {
        Ref file = new File();
        Object readOnly = file.readOnly();
        loggedReadOnly = new Logger(readOnly);
    }

    test {
        Object delegate = new Unknown();
        delegate.test(loggedReadOnly);
    }
}

assert didCall(?X, <file>, "File.read").
assert !didCall(?X, <file>, "File.write").

assert !getsAccess(<delegate>, <file>).
assert !getsAccess(<delegate>, <readOnly>).

expectFailure.
